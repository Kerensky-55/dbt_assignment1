version: 2

models:
  - name: fct_sales
    description: Fact table for sales transactions, containing details about invoices, customers, and revenue.
    columns:
      - name: invoice_no
        description: Invoice number. Nominal. A 6-digit integral number uniquely assigned to each transaction. If this code starts with the letter 'c', it indicates a cancellation.
        tests:
          - not_null
      - name: stock_code
        description: Product (item) code. Nominal. A 5-digit integral number uniquely assigned to each distinct product.
        tests:
          - not_null
      - name: description
        description: Product (item) name. Nominal.
        tests:
          - not_null
      - name: customer_id
        description: Customer number. Nominal. A 5-digit integral number uniquely assigned to each customer.
        tests:
          - not_null
      - name: invoice_date
        description: Invoice date and time. Numeric. The day and time when a transaction was generated.
        tests:
          - not_null
      - name: quantity
        description: The quantities of each product (item) per transaction. Numeric.
        tests:
          - not_null
      - name: unit_price
        description: Unit price. Numeric. Product price per unit in sterling (Â£).
        tests:
          - not_null
      - name: revenue
        description: Total revenue generated by the transaction (quantity * unit price).
        tests:
          - not_null

  - name: fct_rfm
    description: Fact table for RFM (Recency, Frequency, Monetary) analysis of customers.
    columns:
      - name: customer_id
        description: Customer number. Nominal. A 5-digit integral number uniquely assigned to each customer.
        tests:
          - not_null
          - unique
      - name: recency
        description: Days since the last purchase.
        tests:
          - not_null
      - name: frequency
        description: Total number of orders placed by the customer.
        tests:
          - not_null
      - name: monetary_value
        description: Total amount spent by the customer.
        tests:
          - not_null

  - name: fct_customer_segmentation
    description: Fact table for customer segmentation based on RFM analysis.
    columns:
      - name: customer_id
        description: Customer number. Nominal. A 5-digit integral number uniquely assigned to each customer.
        tests:
          - not_null
          - unique
      - name: recency
        description: Days since the last purchase.
        tests:
          - not_null
      - name: recency_tier
        description: RFM tier based on recency score.
        tests:
          - not_null
      - name: frequency
        description: Total number of orders placed by the customer.
        tests:
          - not_null
      - name: frequency_tier
        description: RFM tier based on frequency score.
        tests:
          - not_null
      - name: monetary_value
        description: Total amount spent by the customer.
        tests:
          - not_null
      - name: monetary_tier
        description: RFM tier based on monetary score.
        tests:
          - not_null
      - name: customer_segment
        description: Segment classification based on RFM analysis. "{{ doc('customer_segments_facts') }}"
        tests:
          - not_null
          - accepted_values:
              values:
                - Best Customer
                - High-Spending New Customer
                - Lowest-Spending Active Loyal Customer
                - Churned Best Customer
                - Normal Customer
